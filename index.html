<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lịch Thi Học Sinh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .exam-card {
            transition: all 0.3s ease;
        }
        .exam-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .notice-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
        }
        @media (max-width: 768px) {
            .mobile-responsive {
                padding: 0.75rem;
            }
            .mobile-card {
                margin-bottom: 0.75rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-full">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Trường THPT Nguyễn Khuyến</h1>
            <h2 class="text-xl md:text-2xl font-semibold text-gray-700 mb-2">LỊCH KIỂM TRA GIỮA HỌC KÌ I</h2>
            <p class="text-lg text-gray-600 font-medium mb-4">NĂM HỌC 2025-2026</p>
            <div class="flex justify-center">
                <a href="https://tkbnkhoahung.github.io/tkbnk2526hs/" target="_blank" rel="noopener noreferrer" 
                   class="bg-blue-500 text-white px-6 py-3 rounded-lg font-medium text-lg hover:bg-blue-600 transition-colors duration-300">
                    Trang Chủ
                </a>
            </div>
        </div>

        <!-- Block Selection -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Chọn khối học</h2>
            <div class="flex flex-wrap gap-4 justify-center mb-4">
                <button id="block10" class="block-btn bg-blue-50 text-blue-700 px-6 py-3 rounded-lg font-medium hover:bg-blue-100 transition-colors border border-blue-200">
                    Khối 10
                </button>
                <button id="block11" class="block-btn bg-green-50 text-green-700 px-6 py-3 rounded-lg font-medium hover:bg-green-100 transition-colors border border-green-200">
                    Khối 11
                </button>
                <button id="block12" class="block-btn bg-purple-50 text-purple-700 px-6 py-3 rounded-lg font-medium hover:bg-purple-100 transition-colors border border-purple-200">
                    Khối 12
                </button>
            </div>
            <div class="text-center">
                <button id="exportWallpaper" class="bg-gray-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Xuất Hình Nền Điện Thoại
                </button>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Bộ lọc</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Buổi</label>
                    <select id="sessionFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-800">
                        <option value="">Tất cả buổi</option>
                        <option value="Sáng">Buổi sáng</option>
                        <option value="Chiều">Buổi chiều</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Môn học</label>
                    <select id="subjectFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-800">
                        <option value="">Tất cả môn</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Notice Section -->
        <div id="noticeSection" class="bg-white rounded-lg shadow-md p-4 md:p-6 mb-8 hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Thông báo quan trọng</h2>
            <div id="morningNotice" class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg mb-4 hidden">
                <h3 class="font-semibold text-gray-800 mb-2">Buổi thi sáng</h3>
                <div class="text-sm text-gray-700 space-y-1">
                    <p><strong class="text-red-600">Ghi chú:</strong></p>
                    <p>• HS đến sau giờ phát đề 5 phút không được vào phòng kiểm tra.</p>
                    <p>• Các buổi không kiểm tra HS được nghỉ.</p>
                    <p>• <strong class="text-red-600">Học sinh có mặt: buổi sáng 7h00'.</strong></p>
                </div>
            </div>
            <div id="afternoonNotice" class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg hidden">
                <h3 class="font-semibold text-gray-800 mb-2">Buổi thi chiều</h3>
                <div class="text-sm text-gray-700 space-y-1">
                    <p><strong class="text-red-600">Ghi chú:</strong></p>
                    <p>• HS đến sau giờ phát đề 5 phút không được vào phòng kiểm tra.</p>
                    <p>• Các buổi không kiểm tra HS được nghỉ.</p>
                    <p>• <strong class="text-red-600">Học sinh có mặt: buổi chiều 13h00'.</strong></p>
                </div>
            </div>
        </div>

        <!-- Block Statistics -->
        <div id="blockStats" class="bg-white rounded-lg shadow-md p-4 md:p-6 mb-8 hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Thống kê khối được chọn</h2>
            <div id="selectedBlockStat" class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <h4 class="font-semibold text-gray-800 mb-2" id="selectedBlockTitle">Chọn một khối để xem thống kê</h4>
                <div class="text-sm text-gray-700 space-y-1" id="selectedBlockInfo">
                    <p>Vui lòng chọn khối học để xem thông tin chi tiết</p>
                </div>
            </div>
        </div>

        <!-- Exam Schedule Display -->
        <div class="bg-white rounded-lg shadow-md p-4 md:p-6 mobile-responsive">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Lịch Thi</h2>
            <div id="examSchedule" class="space-y-4">
                <div class="text-center text-gray-600 py-8">
                    <p class="text-lg">Vui lòng chọn khối học để xem lịch thi</p>
                </div>
            </div>
        </div>

        <!-- Hidden Canvas for Wallpaper Generation -->
        <canvas id="wallpaperCanvas" style="display: none;" width="1080" height="1920"></canvas>

    </div>

    <script>
        let examData = [
            {day: 'Thứ ba', date: '28/10/2025', block: '10', session: 'Sáng', subject: 'Văn', startTime: '07:30', endTime: '09:00', duration: 90},
            {day: 'Thứ năm', date: '30/10/2025', block: '10', session: 'Sáng', subject: 'Toán', startTime: '07:30', endTime: '08:20', duration: 50},
            {day: 'Thứ bảy', date: '01/11/2025', block: '10', session: 'Sáng', subject: 'Anh', startTime: '07:30', endTime: '08:20', duration: 50},
            {day: 'Thứ ba', date: '28/10/2025', block: '10', session: 'Sáng', subject: 'Lý', startTime: '09:45', endTime: '10:35', duration: 50},
            {day: 'Thứ năm', date: '30/10/2025', block: '10', session: 'Sáng', subject: 'Sinh', startTime: '09:05', endTime: '09:55', duration: 50},
            {day: 'Thứ bảy', date: '01/11/2025', block: '10', session: 'Sáng', subject: 'Hóa', startTime: '09:05', endTime: '09:55', duration: 50},
            {day: 'Thứ ba', date: '28/10/2025', block: '10', session: 'Sáng', subject: 'GDKT và PL', startTime: '09:45', endTime: '10:35', duration: 50},
            {day: 'Thứ năm', date: '30/10/2025', block: '10', session: 'Sáng', subject: 'Địa', startTime: '09:05', endTime: '09:55', duration: 50},
            {day: 'Thứ bảy', date: '01/11/2025', block: '10', session: 'Sáng', subject: 'Sử', startTime: '09:05', endTime: '09:55', duration: 50},
            {day: 'Thứ hai', date: '27/10/2025', block: '11', session: 'Chiều', subject: 'Văn', startTime: '13:30', endTime: '15:00', duration: 90},
            {day: 'Thứ tư', date: '29/10/2025', block: '11', session: 'Chiều', subject: 'Toán', startTime: '13:30', endTime: '14:20', duration: 50},
            {day: 'Thứ sáu', date: '31/10/2025', block: '11', session: 'Chiều', subject: 'Hóa', startTime: '13:30', endTime: '14:20', duration: 50},
            {day: 'Thứ sáu', date: '31/10/2025', block: '11', session: 'Chiều', subject: 'GDKT và PL', startTime: '13:30', endTime: '14:20', duration: 50},
            {day: 'Thứ hai', date: '27/10/2025', block: '11', session: 'Chiều', subject: 'Lý', startTime: '15:45', endTime: '16:35', duration: 50},
            {day: 'Thứ tư', date: '29/10/2025', block: '11', session: 'Chiều', subject: 'Sinh', startTime: '15:05', endTime: '15:55', duration: 50},
            {day: 'Thứ sáu', date: '31/10/2025', block: '11', session: 'Chiều', subject: 'Anh', startTime: '15:05', endTime: '15:55', duration: 50},
            {day: 'Thứ hai', date: '27/10/2025', block: '11', session: 'Chiều', subject: 'Địa', startTime: '15:45', endTime: '16:35', duration: 50},
            {day: 'Thứ tư', date: '29/10/2025', block: '11', session: 'Chiều', subject: 'Sử', startTime: '15:05', endTime: '15:55', duration: 50},
            {day: 'Thứ hai', date: '27/10/2025', block: '12', session: 'Sáng', subject: 'Văn', startTime: '07:30', endTime: '09:00', duration: 90},
            {day: 'Thứ tư', date: '29/10/2025', block: '12', session: 'Sáng', subject: 'Toán', startTime: '07:30', endTime: '08:20', duration: 50},
            {day: 'Thứ sáu', date: '31/10/2025', block: '12', session: 'Sáng', subject: 'Lý', startTime: '07:30', endTime: '08:20', duration: 50},
            {day: 'Thứ hai', date: '27/10/2025', block: '12', session: 'Sáng', subject: 'Anh', startTime: '09:45', endTime: '10:35', duration: 50},
            {day: 'Thứ tư', date: '29/10/2025', block: '12', session: 'Sáng', subject: 'Sinh', startTime: '09:05', endTime: '09:55', duration: 50},
            {day: 'Thứ sáu', date: '31/10/2025', block: '12', session: 'Sáng', subject: 'Hóa', startTime: '09:05', endTime: '09:55', duration: 50},
            {day: 'Thứ tư', date: '29/10/2025', block: '12', session: 'Sáng', subject: 'Địa', startTime: '09:05', endTime: '09:55', duration: 50},
            {day: 'Thứ sáu', date: '31/10/2025', block: '12', session: 'Sáng', subject: 'Sử', startTime: '09:05', endTime: '09:55', duration: 50}
        ];
        let filteredData = [];
        let selectedBlock = '';



        // Sort exam data by day of week, then date and time
        function sortExamData() {
            const dayOrder = {
                'Thứ hai': 1, 'Thứ ba': 2, 'Thứ tư': 3, 'Thứ năm': 4, 
                'Thứ sáu': 5, 'Thứ bảy': 6, 'Chủ nhật': 7
            };

            examData.sort((a, b) => {
                // First sort by date
                const dateA = new Date(a.date.split('/').reverse().join('-'));
                const dateB = new Date(b.date.split('/').reverse().join('-'));
                
                if (dateA.getTime() !== dateB.getTime()) {
                    return dateA - dateB;
                }
                
                // Then sort by day of week
                const dayA = dayOrder[a.day] || 8;
                const dayB = dayOrder[b.day] || 8;
                
                if (dayA !== dayB) {
                    return dayA - dayB;
                }
                
                // Then sort by session (Sáng before Chiều)
                if (a.session !== b.session) {
                    return a.session === 'Sáng' ? -1 : 1;
                }
                
                // Finally sort by start time
                const timeA = a.startTime.split(':').map(Number);
                const timeB = b.startTime.split(':').map(Number);
                const minutesA = timeA[0] * 60 + timeA[1];
                const minutesB = timeB[0] * 60 + timeB[1];
                
                return minutesA - minutesB;
            });
        }

        // Populate filter dropdowns
        function populateFilters() {
            const subjects = [...new Set(examData.map(exam => exam.subject))];
            const subjectFilter = document.getElementById('subjectFilter');
            
            // Clear existing options except "Tất cả môn"
            subjectFilter.innerHTML = '<option value="">Tất cả môn</option>';
            
            subjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                subjectFilter.appendChild(option);
            });
        }

        // Update statistics for selected block
        function updateSelectedBlockStats() {
            if (!selectedBlock) {
                document.getElementById('selectedBlockTitle').textContent = 'Chọn một khối để xem thống kê';
                document.getElementById('selectedBlockInfo').innerHTML = '<p>Vui lòng chọn khối học để xem thông tin chi tiết</p>';
                return;
            }

            const blockExams = examData.filter(exam => exam.block === selectedBlock);
            const uniqueDates = [...new Set(blockExams.map(exam => exam.date))];
            const uniqueDays = [...new Set(blockExams.map(exam => exam.day))];
            const morningExams = blockExams.filter(exam => exam.session === 'Sáng').length;
            const afternoonExams = blockExams.filter(exam => exam.session === 'Chiều').length;


            const blockColors = {
                '10': { bg: 'bg-blue-50', border: 'border-blue-200', text: 'text-blue-800' },
                '11': { bg: 'bg-green-50', border: 'border-green-200', text: 'text-green-800' },
                '12': { bg: 'bg-purple-50', border: 'border-purple-200', text: 'text-purple-800' }
            };

            const color = blockColors[selectedBlock];
            const statDiv = document.getElementById('selectedBlockStat');
            statDiv.className = `${color.bg} ${color.border} border rounded-lg p-4`;

            document.getElementById('selectedBlockTitle').textContent = `Khối ${selectedBlock}`;
            document.getElementById('selectedBlockTitle').className = `font-semibold ${color.text} mb-2`;
            
            document.getElementById('selectedBlockInfo').innerHTML = `
                <div class="text-sm ${color.text.replace('800', '700')} space-y-1">
                    <p>Số môn thi: <span class="font-medium text-red-600">${blockExams.length}</span></p>
                    <p>Số ngày thi: <span class="font-medium text-red-600">${uniqueDates.length}</span></p>
                    <p>Các ngày: <span class="font-medium text-red-600">${uniqueDays.length > 0 ? uniqueDays.join(', ') : '-'}</span></p>
                    <p>Thi buổi sáng: <span class="font-medium text-red-600">${morningExams}</span></p>
                    <p>Thi buổi chiều: <span class="font-medium text-red-600">${afternoonExams}</span></p>

                </div>
            `;
        }

        // Filter data
        function filterData() {
            const sessionFilter = document.getElementById('sessionFilter').value;
            const subjectFilter = document.getElementById('subjectFilter').value;

            filteredData = examData.filter(exam => {
                return (!selectedBlock || exam.block === selectedBlock) &&
                       (!sessionFilter || exam.session === sessionFilter) &&
                       (!subjectFilter || exam.subject === subjectFilter);
            });

            updateNotices();
            displayExams();
        }

        // Update notices based on filtered data
        function updateNotices() {
            const dataToShow = filteredData.length > 0 ? filteredData : examData;
            const hasMorning = dataToShow.some(exam => exam.session === 'Sáng');
            const hasAfternoon = dataToShow.some(exam => exam.session === 'Chiều');

            const noticeSection = document.getElementById('noticeSection');
            const morningNotice = document.getElementById('morningNotice');
            const afternoonNotice = document.getElementById('afternoonNotice');

            if (hasMorning || hasAfternoon) {
                noticeSection.classList.remove('hidden');
                morningNotice.classList.toggle('hidden', !hasMorning);
                afternoonNotice.classList.toggle('hidden', !hasAfternoon);
            } else {
                noticeSection.classList.add('hidden');
            }
        }

        // Block selection handlers
        function selectBlock(block) {
            selectedBlock = block;
            
            // Update button styles
            document.querySelectorAll('.block-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'bg-green-500', 'bg-purple-500', 'text-white', 'border-blue-500', 'border-green-500', 'border-purple-500');
                btn.classList.add('bg-gray-50', 'text-gray-700', 'border-gray-200');
            });
            
            const activeBtn = document.getElementById(`block${block}`);
            activeBtn.classList.remove('bg-gray-50', 'text-gray-700', 'border-gray-200');
            
            if (block === '10') {
                activeBtn.classList.add('bg-blue-500', 'text-white', 'border-blue-500');
            } else if (block === '11') {
                activeBtn.classList.add('bg-green-500', 'text-white', 'border-green-500');
            } else if (block === '12') {
                activeBtn.classList.add('bg-purple-500', 'text-white', 'border-purple-500');
            }
            
            // Enable export button when block is selected
            document.getElementById('exportWallpaper').disabled = false;
            
            updateSelectedBlockStats();
            filterData();
        }

        // Generate wallpaper for selected block
        function generateWallpaper() {
            if (!selectedBlock) return;

            const canvas = document.getElementById('wallpaperCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Block colors
            const blockColors = {
                '10': { primary: '#3B82F6', secondary: '#DBEAFE', accent: '#1E40AF' },
                '11': { primary: '#10B981', secondary: '#D1FAE5', accent: '#047857' },
                '12': { primary: '#8B5CF6', secondary: '#EDE9FE', accent: '#5B21B6' }
            };
            
            const colors = blockColors[selectedBlock];
            
            // Create gradient background
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, colors.secondary);
            gradient.addColorStop(1, '#F8FAFC');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Header section
            ctx.fillStyle = colors.primary;
            ctx.fillRect(0, 0, canvas.width, 300);
            
            // School name
            ctx.fillStyle = 'white';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('THPT Nguyễn Khuyến', canvas.width / 2, 80);
            
            ctx.font = 'bold 36px Arial';
            ctx.fillText('LỊCH KIỂM TRA GIỮA HỌC KÌ I', canvas.width / 2, 140);
            
            ctx.font = '28px Arial';
            ctx.fillText('NĂM HỌC 2025-2026', canvas.width / 2, 180);
            
            // Block indicator
            ctx.font = 'bold 40px Arial';
            ctx.fillText(`KHỐI ${selectedBlock}`, canvas.width / 2, 240);
            
            // Get block exams
            const blockExams = examData.filter(exam => exam.block === selectedBlock);
            
            // Group by date
            const groupedByDate = {};
            blockExams.forEach(exam => {
                if (!groupedByDate[exam.date]) {
                    groupedByDate[exam.date] = [];
                }
                groupedByDate[exam.date].push(exam);
            });
            
            // Sort dates
            const dayOrder = {
                'Thứ hai': 1, 'Thứ ba': 2, 'Thứ tư': 3, 'Thứ năm': 4, 
                'Thứ sáu': 5, 'Thứ bảy': 6, 'Chủ nhật': 7
            };
            
            const sortedDates = Object.keys(groupedByDate).sort((a, b) => {
                const dateA = new Date(a.split('/').reverse().join('-'));
                const dateB = new Date(b.split('/').reverse().join('-'));
                
                if (dateA.getTime() !== dateB.getTime()) {
                    return dateA - dateB;
                }
                
                const dayA = dayOrder[groupedByDate[a][0].day] || 8;
                const dayB = dayOrder[groupedByDate[b][0].day] || 8;
                return dayA - dayB;
            });
            
            let yPos = 350;
            const cardHeight = 120;
            const cardMargin = 20;
            const cardPadding = 20;
            
            sortedDates.forEach(date => {
                const exams = groupedByDate[date];
                
                // Sort exams within the same date
                exams.sort((a, b) => {
                    if (a.session !== b.session) {
                        return a.session === 'Sáng' ? -1 : 1;
                    }
                    const timeA = a.startTime.split(':').map(Number);
                    const timeB = b.startTime.split(':').map(Number);
                    const minutesA = timeA[0] * 60 + timeA[1];
                    const minutesB = timeB[0] * 60 + timeB[1];
                    return minutesA - minutesB;
                });
                
                // Date header
                ctx.fillStyle = colors.accent;
                ctx.font = 'bold 32px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(`${exams[0].day}, ${date}`, 40, yPos);
                yPos += 50;
                
                // Exams for this date
                exams.forEach(exam => {
                    // Card background
                    ctx.fillStyle = 'white';
                    ctx.shadowColor = 'rgba(0,0,0,0.1)';
                    ctx.shadowBlur = 10;
                    ctx.shadowOffsetY = 4;
                    ctx.fillRect(40, yPos, canvas.width - 80, cardHeight);
                    ctx.shadowBlur = 0;
                    
                    // Card border
                    ctx.strokeStyle = colors.primary;
                    ctx.lineWidth = 3;
                    ctx.strokeRect(40, yPos, canvas.width - 80, cardHeight);
                    
                    // Subject name
                    ctx.fillStyle = colors.accent;
                    ctx.font = 'bold 36px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(exam.subject, 60, yPos + 45);
                    
                    // Session and time
                    ctx.fillStyle = '#374151';
                    ctx.font = '28px Arial';
                    ctx.fillText(`${exam.session}`, 60, yPos + 80);
                    
                    ctx.fillText(`${exam.startTime} - ${exam.endTime}`, 300, yPos + 80);
                    
                    // Duration
                    ctx.fillStyle = colors.primary;
                    ctx.font = 'bold 24px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${exam.duration} phút`, canvas.width - 60, yPos + 60);
                    
                    yPos += cardHeight + cardMargin;
                });
                
                yPos += 30; // Extra space between dates
            });
            
            // Footer
            ctx.fillStyle = colors.primary;
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('HS có mặt: Sáng 7h00\' - Chiều 13h00\'', canvas.width / 2, canvas.height - 80);
            ctx.fillText('Đến muộn quá 5 phút không được vào phòng thi', canvas.width / 2, canvas.height - 40);
            
            // Download the image
            const link = document.createElement('a');
            link.download = `lich-thi-khoi-${selectedBlock}-wallpaper.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // Display exams
        function displayExams() {
            const container = document.getElementById('examSchedule');
            const dataToShow = filteredData.length > 0 ? filteredData : examData;

            if (dataToShow.length === 0) {
                if (!selectedBlock) {
                    container.innerHTML = `
                        <div class="text-center text-gray-600 py-8">
                            <p class="text-lg">Vui lòng chọn khối học để xem lịch thi</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="text-center text-gray-600 py-8">
                            <p class="text-lg">Không tìm thấy lịch thi phù hợp với bộ lọc</p>
                        </div>
                    `;
                }
                return;
            }

            // Group by date and sort by day of week order
            const groupedByDate = {};
            dataToShow.forEach(exam => {
                if (!groupedByDate[exam.date]) {
                    groupedByDate[exam.date] = [];
                }
                groupedByDate[exam.date].push(exam);
            });

            // Sort dates by day of week order
            const dayOrder = {
                'Thứ hai': 1, 'Thứ ba': 2, 'Thứ tư': 3, 'Thứ năm': 4, 
                'Thứ sáu': 5, 'Thứ bảy': 6, 'Chủ nhật': 7
            };

            const sortedDates = Object.keys(groupedByDate).sort((a, b) => {
                const dateA = new Date(a.split('/').reverse().join('-'));
                const dateB = new Date(b.split('/').reverse().join('-'));
                
                if (dateA.getTime() !== dateB.getTime()) {
                    return dateA - dateB;
                }
                
                const dayA = dayOrder[groupedByDate[a][0].day] || 8;
                const dayB = dayOrder[groupedByDate[b][0].day] || 8;
                return dayA - dayB;
            });

            let html = '';
            sortedDates.forEach(date => {
                const exams = groupedByDate[date];
                // Sort exams within the same date
                exams.sort((a, b) => {
                    if (a.session !== b.session) {
                        return a.session === 'Sáng' ? -1 : 1;
                    }
                    const timeA = a.startTime.split(':').map(Number);
                    const timeB = b.startTime.split(':').map(Number);
                    const minutesA = timeA[0] * 60 + timeA[1];
                    const minutesB = timeB[0] * 60 + timeB[1];
                    return minutesA - minutesB;
                });

                html += `
                    <div class="fade-in mobile-card">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3 border-b border-gray-200 pb-2">
                            ${exams[0].day}, ${date}
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4 mb-6">
                `;

                exams.forEach(exam => {
                    const blockColor = exam.block === '10' ? 'bg-blue-50 border-blue-300' : 
                                      exam.block === '11' ? 'bg-green-50 border-green-300' : 
                                      'bg-purple-50 border-purple-300';
                    
                    const blockTextColor = exam.block === '10' ? 'text-blue-600' : 
                                          exam.block === '11' ? 'text-green-600' : 
                                          'text-purple-600';
                    
                    html += `
                        <div class="exam-card ${blockColor} border-2 rounded-lg p-4 md:p-5">
                            <div class="flex justify-between items-start mb-3">
                                <span class="text-lg font-bold ${blockTextColor}">Khối ${exam.block}</span>
                                <span class="text-sm bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full font-medium">${exam.duration} phút</span>
                            </div>
                            <h4 class="font-bold text-indigo-600 mb-3 text-lg md:text-xl">${exam.subject}</h4>
                            <div class="text-base text-cyan-600 space-y-2 font-medium">
                                <div class="flex items-center">
                                    <span class="w-16">${exam.session}</span>
                                </div>
                                <div class="flex items-center">
                                    <span>${exam.startTime} - ${exam.endTime}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div></div>';
            });

            container.innerHTML = html;
        }

        // Add event listeners for filters
        document.getElementById('sessionFilter').addEventListener('change', filterData);
        document.getElementById('subjectFilter').addEventListener('change', filterData);
        
        // Add event listeners for block buttons
        document.getElementById('block10').addEventListener('click', () => selectBlock('10'));
        document.getElementById('block11').addEventListener('click', () => selectBlock('11'));
        document.getElementById('block12').addEventListener('click', () => selectBlock('12'));
        
        // Add event listener for wallpaper export
        document.getElementById('exportWallpaper').addEventListener('click', generateWallpaper);

        // Initialize with sample data
        function initializeSampleData() {
            sortExamData();
            populateFilters();
            updateSelectedBlockStats();
            updateNotices();
            displayExams();
            document.getElementById('blockStats').classList.remove('hidden');
            

        }

        // Initialize on page load
        initializeSampleData();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98ed290b748340cc',t:'MTc2MDUwODY5OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
